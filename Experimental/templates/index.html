<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Heart Disease Prediction System</title>
   <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
   <style>
      * {
         margin: 0;
         padding: 0;
         box-sizing: border-box;
      }

      body {
         font-family: Arial, sans-serif;
         background: #f0f2f5;
      }

      .container {
         max-width: 1200px;
         margin: 0 auto;
         padding: 20px;
      }

      .header {
         text-align: center;
         margin-bottom: 30px;
      }

      .tabs {
         display: flex;
         background: white;
         border-radius: 10px;
         margin-bottom: 20px;
      }

      .tab {
         flex: 1;
         padding: 15px;
         text-align: center;
         cursor: pointer;
      }

      .tab.active {
         background: #007bff;
         color: white;
      }

      .tab-content {
         display: none;
         background: white;
         padding: 20px;
         border-radius: 10px;
      }

      .tab-content.active {
         display: block;
      }

      .card {
         background: white;
         padding: 20px;
         margin-bottom: 20px;
         border-radius: 10px;
         box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .btn {
         background: #007bff;
         color: white;
         border: none;
         padding: 10px 20px;
         cursor: pointer;
         margin: 5px;
         border-radius: 5px;
      }

      .btn:hover {
         background: #0056b3;
      }

      .btn-success {
         background: #28a745;
      }

      .btn-success:hover {
         background: #1e7e34;
      }

      .btn-danger {
         background: #dc3545;
      }

      .btn-danger:hover {
         background: #c82333;
      }

      .grid {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
         gap: 20px;
      }

      .form-group {
         margin-bottom: 15px;
      }

      .form-group label {
         display: block;
         margin-bottom: 5px;
         font-weight: bold;
      }

      .form-group input,
      .form-group select {
         width: 100%;
         padding: 8px;
         border: 1px solid #ddd;
         border-radius: 4px;
      }

      .file-upload {
         border: 2px dashed #007bff;
         border-radius: 10px;
         padding: 40px;
         text-align: center;
         cursor: pointer;
         transition: all 0.3s ease;
         margin-bottom: 20px;
      }

      .file-upload:hover {
         border-color: #0056b3;
         background: #f8f9fa;
      }

      .file-upload input[type="file"] {
         display: none;
      }

      .alert {
         padding: 15px;
         border-radius: 5px;
         margin-bottom: 20px;
      }

      .alert-success {
         background: #d4edda;
         color: #155724;
         border: 1px solid #c3e6cb;
      }

      .alert-danger {
         background: #f8d7da;
         color: #721c24;
         border: 1px solid #f5c6cb;
      }

      .alert-info {
         background: #d1ecf1;
         color: #0c5460;
         border: 1px solid #bee5eb;
      }

      .stats-grid {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
         gap: 15px;
         margin: 20px 0;
      }

      .stat-card {
         background: linear-gradient(135deg, #007bff, #0056b3);
         color: white;
         padding: 20px;
         border-radius: 10px;
         text-align: center;
      }

      .stat-card h3 {
         font-size: 2rem;
         margin-bottom: 10px;
      }

      .model-card {
         background: #f8f9fa;
         border: 1px solid #dee2e6;
         border-radius: 8px;
         padding: 15px;
         margin-bottom: 10px;
      }

      .model-card h4 {
         color: #007bff;
         margin-bottom: 10px;
      }

      .loading {
         display: none;
         text-align: center;
         padding: 20px;
      }

      .spinner {
         border: 4px solid #f3f3f3;
         border-top: 4px solid #007bff;
         border-radius: 50%;
         width: 40px;
         height: 40px;
         animation: spin 1s linear infinite;
         margin: 0 auto 15px;
      }

      @keyframes spin {
         0% {
            transform: rotate(0deg);
         }

         100% {
            transform: rotate(360deg);
         }
      }

      .prediction-result {
         background: linear-gradient(135deg, #28a745, #20c997);
         color: white;
         padding: 30px;
         border-radius: 10px;
         text-align: center;
         margin-top: 20px;
      }

      .prediction-result.high-risk {
         background: linear-gradient(135deg, #dc3545, #fd7e14);
      }

      .recommendations {
         background: #fff3cd;
         border: 1px solid #ffeaa7;
         border-radius: 5px;
         padding: 15px;
         margin-top: 15px;
      }

      .recommendations h4 {
         color: #856404;
         margin-bottom: 10px;
      }

      .recommendations ul {
         color: #856404;
         margin-left: 20px;
      }
   </style>
</head>

<body>
   <div class="container">
      <div class="header">
         <h1>Heart Disease Prediction System</h1>
         <p>Machine Learning Models for Cardiovascular Risk Assessment</p>
      </div>

      <div class="tabs">
         <div class="tab active" onclick="showTab('dashboard')">Dashboard</div>
         <div class="tab" onclick="showTab('data')">Data Management</div>
         <div class="tab" onclick="showTab('training')">Model Training</div>
         <div class="tab" onclick="showTab('prediction')">Prediction</div>
         <div class="tab" onclick="showTab('visualizations')">Analytics</div>
      </div>

      <div id="dashboard" class="tab-content active">
         <div class="card">
            <h3>System Overview</h3>
            <p>Welcome to the Heart Disease Prediction System. Upload your dataset, train models, and make predictions.
            </p>
         </div>
         <div class="stats-grid">
            <div class="stat-card">
               <h3 id="totalRecords">0</h3>
               <p>Total Records</p>
            </div>
            <div class="stat-card">
               <h3 id="trainedModels">0</h3>
               <p>Trained Models</p>
            </div>
            <div class="stat-card">
               <h3 id="avgAccuracy">0%</h3>
               <p>Best Accuracy</p>
            </div>
         </div>
         <div class="card">
            <h3>Available Models</h3>
            <div id="modelsList"></div>
         </div>
      </div>

      <div id="data" class="tab-content">
         <div class="card">
            <h3>Dataset Management</h3>
            <p>Upload your own heart disease dataset or use the built-in sample data.</p>

            <div class="file-upload" onclick="document.getElementById('fileInput').click()">
               <h4>üìÅ Upload CSV Dataset</h4>
               <p>Click to upload your heart disease dataset (CSV format)</p>
               <p><strong>Required columns:</strong> age, sex, cp, trestbps, chol, fbs, restecg, thalach, exang,
                  oldpeak, slope, ca, thal, target</p>
               <p><strong>Target values:</strong> 0 (no disease), 1 (disease)</p>
            </div>
            <input type="file" id="fileInput" accept=".csv" onchange="handleFileUpload(event)">

            <div style="text-align: center;">
               <button class="btn btn-success" onclick="initializeSampleData()">üìä Initialize Sample Data</button>
               <button class="btn" onclick="loadDatasetInfo()">üìà Load Dataset Info</button>
               <button class="btn" onclick="downloadTemplate()">üì• Download Template</button>
            </div>

            <div id="uploadStatus"></div>
            <div id="datasetInfo"></div>
         </div>
      </div>

      <div id="training" class="tab-content">
         <div class="card">
            <h3>Model Training</h3>
            <p>Select a machine learning algorithm and train it on your dataset.</p>

            <div class="form-group">
               <label for="modelType">Model Type:</label>
               <select id="modelType">
                  <option value="random_forest">Random Forest (Recommended)</option>
                  <option value="logistic_regression">Logistic Regression</option>
                  <option value="neural_network">Neural Network</option>
                  <option value="svm">Support Vector Machine</option>
                  <option value="knn">K-Nearest Neighbors</option>
                  <option value="decision_tree">Decision Tree</option>
                  <option value="naive_bayes">Naive Bayes</option>
                  <option value="xgboost">XGBoost</option>
               </select>
            </div>

            <button class="btn btn-success" onclick="trainModel()">üöÄ Train Model</button>

            <div class="loading" id="trainingLoading">
               <div class="spinner"></div>
               <p>Training model... This may take a few minutes.</p>
            </div>

            <div id="trainingResults"></div>
         </div>
      </div>

      <div id="prediction" class="tab-content">
         <div class="card">
            <h3>Heart Disease Risk Prediction</h3>
            <p>Enter patient information to predict the risk of heart disease.</p>

            <div class="grid">
               <div class="form-group">
                  <label>Age:</label>
                  <input type="number" id="age" placeholder="Enter age" min="1" max="120">
               </div>
               <div class="form-group">
                  <label>Sex:</label>
                  <select id="sex">
                     <option value="1">Male</option>
                     <option value="0">Female</option>
                  </select>
               </div>
               <div class="form-group">
                  <label>Chest Pain Type:</label>
                  <select id="cp">
                     <option value="0">Typical Angina</option>
                     <option value="1">Atypical Angina</option>
                     <option value="2">Non-anginal Pain</option>
                     <option value="3">Asymptomatic</option>
                  </select>
               </div>
               <div class="form-group">
                  <label>Blood Pressure (mm Hg):</label>
                  <input type="number" id="trestbps" placeholder="Enter blood pressure" min="90" max="200">
               </div>
               <div class="form-group">
                  <label>Cholesterol (mg/dl):</label>
                  <input type="number" id="chol" placeholder="Enter cholesterol" min="100" max="600">
               </div>
               <div class="form-group">
                  <label>Fasting Blood Sugar > 120:</label>
                  <select id="fbs">
                     <option value="0">No</option>
                     <option value="1">Yes</option>
                  </select>
               </div>
               <div class="form-group">
                  <label>Resting ECG:</label>
                  <select id="restecg">
                     <option value="0">Normal</option>
                     <option value="1">ST-T Wave Abnormality</option>
                     <option value="2">Left Ventricular Hypertrophy</option>
                  </select>
               </div>
               <div class="form-group">
                  <label>Max Heart Rate:</label>
                  <input type="number" id="thalach" placeholder="Enter heart rate" min="60" max="202">
               </div>
               <div class="form-group">
                  <label>Exercise Angina:</label>
                  <select id="exang">
                     <option value="0">No</option>
                     <option value="1">Yes</option>
                  </select>
               </div>
               <div class="form-group">
                  <label>ST Depression:</label>
                  <input type="number" id="oldpeak" placeholder="Enter ST depression" min="0" max="6.2" step="0.1">
               </div>
               <div class="form-group">
                  <label>ST Slope:</label>
                  <select id="slope">
                     <option value="0">Upsloping</option>
                     <option value="1">Flat</option>
                     <option value="2">Downsloping</option>
                  </select>
               </div>
               <div class="form-group">
                  <label>Major Vessels:</label>
                  <select id="ca">
                     <option value="0">0</option>
                     <option value="1">1</option>
                     <option value="2">2</option>
                     <option value="3">3</option>
                  </select>
               </div>
               <div class="form-group">
                  <label>Thalassemia:</label>
                  <select id="thal">
                     <option value="1">Normal</option>
                     <option value="2">Fixed Defect</option>
                     <option value="3">Reversible Defect</option>
                  </select>
               </div>
            </div>

            <div class="form-group">
               <label for="predictionModel">Select Model for Prediction:</label>
               <select id="predictionModel">
                  <option value="">Select a trained model</option>
               </select>
            </div>

            <button class="btn btn-success" onclick="makePrediction()">üîÆ Predict Risk</button>

            <div class="loading" id="predictionLoading">
               <div class="spinner"></div>
               <p>Analyzing data...</p>
            </div>

            <div id="predictionResult"></div>
         </div>
      </div>

      <div id="visualizations" class="tab-content">
         <div class="card">
            <h3>Data Analytics & Visualizations</h3>
            <button class="btn" onclick="loadVisualizations()">üìä Load Charts</button>
            <div id="charts"></div>
         </div>
      </div>
   </div>

   <script>
      function showTab(tabName) {
         document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
         document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
         document.getElementById(tabName).classList.add('active');
         event.target.classList.add('active');

         if (tabName === 'dashboard') {
            loadDashboardData();
         }
      }

      async function handleFileUpload(event) {
         const file = event.target.files[0];
         if (!file) return;

         const formData = new FormData();
         formData.append('file', file);

         const statusDiv = document.getElementById('uploadStatus');
         statusDiv.innerHTML = '<div class="alert alert-info">Uploading file...</div>';

         try {
            const response = await fetch('/api/upload-data', {
               method: 'POST',
               body: formData
            });

            const data = await response.json();
            if (data.success) {
               statusDiv.innerHTML = `<div class="alert alert-success">${data.message}</div>`;
               if (data.dataset_info) {
                  displayDatasetInfo(data.dataset_info);
               }
               loadDashboardData();
            } else {
               statusDiv.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
            }
         } catch (error) {
            statusDiv.innerHTML = `<div class="alert alert-danger">Error uploading file: ${error.message}</div>`;
         }
      }

      async function initializeSampleData() {
         try {
            const response = await fetch('/api/initialize-data', { method: 'POST' });
            const data = await response.json();

            const statusDiv = document.getElementById('uploadStatus');
            if (data.success) {
               statusDiv.innerHTML = `<div class="alert alert-success">${data.message}</div>`;
               loadDatasetInfo();
               loadDashboardData();
            } else {
               statusDiv.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
            }
         } catch (error) {
            document.getElementById('uploadStatus').innerHTML =
               `<div class="alert alert-danger">Error: ${error.message}</div>`;
         }
      }

      async function loadDatasetInfo() {
         try {
            const response = await fetch('/api/dataset-info');
            const data = await response.json();

            if (data.success) {
               displayDatasetInfo(data.data);
            } else {
               document.getElementById('datasetInfo').innerHTML =
                  `<div class="alert alert-info">${data.error}</div>`;
            }
         } catch (error) {
            document.getElementById('datasetInfo').innerHTML =
               `<div class="alert alert-danger">Error: ${error.message}</div>`;
         }
      }

      function displayDatasetInfo(info) {
         const infoDiv = document.getElementById('datasetInfo');
         infoDiv.innerHTML = `
                <div class="card">
                    <h4>Dataset Information</h4>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>${info.shape[0]}</h3>
                            <p>Rows</p>
                        </div>
                        <div class="stat-card">
                            <h3>${info.shape[1]}</h3>
                            <p>Columns</p>
                        </div>
                        <div class="stat-card">
                            <h3>${info.target_distribution[0] || 0}</h3>
                            <p>No Disease</p>
                        </div>
                        <div class="stat-card">
                            <h3>${info.target_distribution[1] || 0}</h3>
                            <p>Disease</p>
                        </div>
                    </div>
                    
                    ${info.feature_stats ? `
                        <h4>Feature Statistics</h4>
                        <div class="grid">
                            <div><strong>Age:</strong> ${info.feature_stats.age.min}-${info.feature_stats.age.max} (avg: ${info.feature_stats.age.mean})</div>
                            <div><strong>Blood Pressure:</strong> ${info.feature_stats.trestbps.min}-${info.feature_stats.trestbps.max} (avg: ${info.feature_stats.trestbps.mean})</div>
                            <div><strong>Cholesterol:</strong> ${info.feature_stats.chol.min}-${info.feature_stats.chol.max} (avg: ${info.feature_stats.chol.mean})</div>
                            <div><strong>Heart Rate:</strong> ${info.feature_stats.thalach.min}-${info.feature_stats.thalach.max} (avg: ${info.feature_stats.thalach.mean})</div>
                        </div>
                    ` : ''}
                </div>
            `;
      }

      async function loadDashboardData() {
         try {
            const [datasetResponse, modelsResponse] = await Promise.all([
               fetch('/api/dataset-info'),
               fetch('/api/models')
            ]);

            const datasetData = await datasetResponse.json();
            const modelsData = await modelsResponse.json();

            if (datasetData.success) {
               document.getElementById('totalRecords').textContent = datasetData.data.shape[0];
            }

            if (modelsData.success) {
               document.getElementById('trainedModels').textContent = modelsData.models.length;
               updateModelsList(modelsData.models);
               updatePredictionModelOptions(modelsData.models);
            }

         } catch (error) {
            console.error('Error loading dashboard data:', error);
         }
      }

      function updateModelsList(models) {
         const modelsListDiv = document.getElementById('modelsList');
         if (models.length === 0) {
            modelsListDiv.innerHTML = '<p>No models trained yet. Go to the Training tab to train your first model.</p>';
            return;
         }

         let html = '';
         models.forEach(model => {
            html += `
                    <div class="model-card">
                        <h4>${model.name}</h4>
                        <p>Type: ${model.type}</p>
                        <button class="btn btn-danger" onclick="deleteModel('${model.name.toLowerCase().replace(/\s+/g, '_')}')">Delete</button>
                    </div>
                `;
         });
         modelsListDiv.innerHTML = html;
      }

      function updatePredictionModelOptions(models) {
         const select = document.getElementById('predictionModel');
         select.innerHTML = '<option value="">Select a trained model</option>';

         models.forEach(model => {
            const option = document.createElement('option');
            option.value = model.name.toLowerCase().replace(/\s+/g, '_');
            option.textContent = model.name;
            select.appendChild(option);
         });
      }

      async function trainModel() {
         const modelType = document.getElementById('modelType').value;
         if (!modelType) {
            alert('Please select a model type');
            return;
         }

         document.getElementById('trainingLoading').style.display = 'block';
         document.getElementById('trainingResults').innerHTML = '';

         try {
            const response = await fetch('/api/train-model', {
               method: 'POST',
               headers: { 'Content-Type': 'application/json' },
               body: JSON.stringify({ model_type: modelType })
            });

            const data = await response.json();

            if (data.success) {
               showTrainingResults(data);
               loadDashboardData();
            } else {
               document.getElementById('trainingResults').innerHTML =
                  `<div class="alert alert-danger">${data.error}</div>`;
            }
         } catch (error) {
            document.getElementById('trainingResults').innerHTML =
               `<div class="alert alert-danger">Error: ${error.message}</div>`;
         } finally {
            document.getElementById('trainingLoading').style.display = 'none';
         }
      }

      function showTrainingResults(data) {
         const resultsDiv = document.getElementById('trainingResults');
         resultsDiv.innerHTML = `
                <div class="alert alert-success">
                    <h4>üéâ Model Trained Successfully!</h4>
                    <p><strong>Model Type:</strong> ${data.model_type.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</p>
                    <p><strong>Accuracy:</strong> ${data.accuracy}%</p>
                    <p><strong>Training Samples:</strong> ${data.training_samples}</p>
                    <p><strong>Testing Samples:</strong> ${data.testing_samples}</p>
                </div>
                
                <div class="card">
                    <h4>Confusion Matrix</h4>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <th style="padding: 8px; border: 1px solid #dee2e6;"></th>
                                <th style="padding: 8px; border: 1px solid #dee2e6;">Predicted No Disease</th>
                                <th style="padding: 8px; border: 1px solid #dee2e6;">Predicted Disease</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>Actual No Disease</strong></td>
                                <td style="padding: 8px; border: 1px solid #dee2e6;">${data.confusion_matrix[0][0]}</td>
                                <td style="padding: 8px; border: 1px solid #dee2e6;">${data.confusion_matrix[0][1]}</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>Actual Disease</strong></td>
                                <td style="padding: 8px; border: 1px solid #dee2e6;">${data.confusion_matrix[1][0]}</td>
                                <td style="padding: 8px; border: 1px solid #dee2e6;">${data.confusion_matrix[1][1]}</td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                ${data.feature_importance ? `
                    <div class="card">
                        <h4>Feature Importance</h4>
                        <div class="grid">
                            ${Object.entries(data.feature_importance)
                  .sort((a, b) => b[1] - a[1])
                  .map(([feature, importance]) =>
                     `<div><strong>${feature}:</strong> ${(importance * 100).toFixed(2)}%</div>`
                  ).join('')}
                        </div>
                    </div>
                ` : ''}
            `;
      }

      async function makePrediction() {
         const features = {
            age: parseInt(document.getElementById('age').value) || 50,
            sex: parseInt(document.getElementById('sex').value),
            cp: parseInt(document.getElementById('cp').value),
            trestbps: parseInt(document.getElementById('trestbps').value) || 120,
            chol: parseInt(document.getElementById('chol').value) || 200,
            fbs: parseInt(document.getElementById('fbs').value),
            restecg: parseInt(document.getElementById('restecg').value),
            thalach: parseInt(document.getElementById('thalach').value) || 150,
            exang: parseInt(document.getElementById('exang').value),
            oldpeak: parseFloat(document.getElementById('oldpeak').value) || 1.0,
            slope: parseInt(document.getElementById('slope').value),
            ca: parseInt(document.getElementById('ca').value),
            thal: parseInt(document.getElementById('thal').value)
         };

         const modelType = document.getElementById('predictionModel').value;
         if (!modelType) {
            alert('Please select a model for prediction');
            return;
         }

         document.getElementById('predictionLoading').style.display = 'block';
         document.getElementById('predictionResult').innerHTML = '';

         try {
            const response = await fetch('/api/predict', {
               method: 'POST',
               headers: { 'Content-Type': 'application/json' },
               body: JSON.stringify({ model_type: modelType, features: features })
            });

            const data = await response.json();

            if (data.success) {
               showPredictionResult(data);
            } else {
               document.getElementById('predictionResult').innerHTML =
                  `<div class="alert alert-danger">${data.error}</div>`;
            }
         } catch (error) {
            document.getElementById('predictionResult').innerHTML =
               `<div class="alert alert-danger">Error: ${error.message}</div>`;
         } finally {
            document.getElementById('predictionLoading').style.display = 'none';
         }
      }

      function showPredictionResult(data) {
         const resultDiv = document.getElementById('predictionResult');
         const isHighRisk = data.prediction === 1;

         resultDiv.innerHTML = `
                <div class="prediction-result ${isHighRisk ? 'high-risk' : ''}">
                    <h3>${data.result_text}</h3>
                    <p><strong>Risk Level:</strong> ${data.risk_level}</p>
                    <p><strong>Confidence:</strong> ${(data.probability * 100).toFixed(1)}%</p>
                </div>
                
                ${data.recommendations && data.recommendations.length > 0 ? `
                    <div class="recommendations">
                        <h4>üí° Health Recommendations</h4>
                        <ul>
                            ${data.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    </div>
                ` : ''}
            `;
      }

      async function deleteModel(modelType) {
         if (!confirm(`Are you sure you want to delete the ${modelType} model?`)) {
            return;
         }

         try {
            const response = await fetch('/api/delete-model', {
               method: 'POST',
               headers: { 'Content-Type': 'application/json' },
               body: JSON.stringify({ model_type: modelType })
            });

            const data = await response.json();
            if (data.success) {
               alert(data.message);
               loadDashboardData();
            } else {
               alert(data.error);
            }
         } catch (error) {
            alert('Error deleting model: ' + error.message);
         }
      }

      async function loadVisualizations() {
         try {
            const response = await fetch('/api/visualizations');
            const data = await response.json();

            if (data.success) {
               const viz = data.visualizations;
               document.getElementById('charts').innerHTML = '<p>Charts loaded successfully! Use the browser console to view them.</p>';

               // Parse and display charts
               try {
                  const targetChart = JSON.parse(viz.target_distribution);
                  const ageChart = JSON.parse(viz.age_distribution);
                  const corrChart = JSON.parse(viz.correlation_heatmap);
                  const sexChart = JSON.parse(viz.sex_target_distribution);
                  const featureChart = JSON.parse(viz.feature_distributions);

                  // Create chart containers
                  document.getElementById('charts').innerHTML = `
                            <div id="targetChart" style="height: 400px; margin: 20px 0;"></div>
                            <div id="ageChart" style="height: 400px; margin: 20px 0;"></div>
                            <div id="corrChart" style="height: 400px; margin: 20px 0;"></div>
                            <div id="sexChart" style="height: 400px; margin: 20px 0;"></div>
                            <div id="featureChart" style="height: 400px; margin: 20px 0;"></div>
                        `;

                  // Render charts
                  Plotly.newPlot('targetChart', targetChart.data, targetChart.layout);
                  Plotly.newPlot('ageChart', ageChart.data, ageChart.layout);
                  Plotly.newPlot('corrChart', corrChart.data, corrChart.layout);
                  Plotly.newPlot('sexChart', sexChart.data, sexChart.layout);
                  Plotly.newPlot('featureChart', featureChart.data, featureChart.layout);

               } catch (e) {
                  console.error('Error parsing charts:', e);
                  document.getElementById('charts').innerHTML = '<p>Charts loaded but could not be displayed. Check console for details.</p>';
               }
            } else {
               document.getElementById('charts').innerHTML =
                  `<div class="alert alert-danger">${data.error}</div>`;
            }
         } catch (error) {
            document.getElementById('charts').innerHTML =
               `<div class="alert alert-danger">Error: ${error.message}</div>`;
         }
      }

      async function downloadTemplate() {
         try {
            const response = await fetch('/api/download-template');
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'heart_disease_template.csv'; // Suggest a filename
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            alert('Template downloaded successfully!');
         } catch (error) {
            alert('Error downloading template: ' + error.message);
         }
      }

      // Load initial data
      document.addEventListener('DOMContentLoaded', function () {
         loadDashboardData();
      });
   </script>
</body>

</html>